@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* ===============================================
       PENNY CENTRAL – UNIFIED DESIGN SYSTEM
       60-30-10 Rule: Neutral-Brand-CTA
       WCAG AAA Compliant Typography & Colors
       See: docs/DESIGN-SYSTEM-AAA.md
       =============================================== */

    /* ===============================================
       MOTION TOKENS
       Consistent animation timing across components
       =============================================== */
    --duration-fast: 150ms;
    --duration-normal: 200ms;
    --duration-slow: 300ms;
    --ease-default: cubic-bezier(0.16, 1, 0.3, 1);
    --ease-hover: ease-out;
    --ease-tap: ease-in;

    /* ===============================================
       COLOR TOKENS
       =============================================== */

    /* 60% - NEUTRAL BASE (backgrounds, text) */
    --bg-primary: #ffffff;
    --bg-secondary: #fafafa;
    --bg-tertiary: #f4f4f5;
    --bg-dark: #18181b;

    /* WCAG AAA compliant text colors (7:1+ contrast) */
    --text-primary: #18181b; /* 17.4:1 on white */
    --text-secondary: #3f3f46; /* 10.1:1 on white */
    --text-muted: #52525b; /* 7.2:1 on white - AAA minimum */
    --text-inverse: #fafafa;

    --border-default: #e4e4e7;
    --border-strong: #d4d4d8;
    --border-dark: #71717a;

    /* 30% - BRAND COLORS (headers, accents, icons) */
    --brand-gunmetal: #374151;
    --brand-gunmetal-light: #4b5563;
    --brand-copper: #b87333;
    --brand-bronze: #cd7f32;

    /* 10% - CTA ACCENT (clickable elements ONLY) */
    --cta-primary: #1d4ed8; /* 8.6:1 contrast - AAA */
    --cta-hover: #1e40af;
    --cta-active: #1e3a8a;
    --cta-text: #ffffff;

    /* SYSTEM COLORS */
    --color-success: #16a34a;
    --color-warning: #d97706;
    --color-error: #dc2626;
    --color-info: #2563eb;

    /* Page backgrounds */
    --bg-page: #ffffff;
    --bg-card: #ffffff;
    --bg-elevated: #fafafa;

    /* Legacy variables for compatibility */
    --accent: #374151;
    --accent-hover: #1c1917;
    --accent-muted: #f5f5f4;
    --accent-emphasis: #1c1917;

    /* Shadows */
    --shadow-card: 0 1px 3px rgba(0, 0, 0, 0.08);
    --shadow-card-hover: 0 4px 12px rgba(0, 0, 0, 0.1);
    --shadow-button: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-button-hover: 0 4px 12px rgba(29, 78, 216, 0.25);

    /* Status colors - functional only */
    --success: #16a34a;
    --error: #dc2626;
    --warning: #d97706;

    /* shadcn/ui compatibility */
    --background: var(--bg-page);
    --foreground: var(--text-primary);
    --card: var(--bg-card);
    --card-foreground: var(--text-primary);
    --popover: var(--bg-card);
    --popover-foreground: var(--text-primary);
    --primary: var(--cta-primary);
    --primary-foreground: #ffffff;
    --secondary: var(--bg-elevated);
    --secondary-foreground: var(--text-primary);
    --muted: var(--bg-elevated);
    --muted-foreground: var(--text-muted);
    --accent-foreground: #ffffff;
    --destructive: var(--error);
    --destructive-foreground: #ffffff;
    --border: var(--border-default);
    --input: var(--border-default);
    --ring: var(--cta-primary);
    --radius: 0.5rem;
  }

  .dark {
    /* Dark mode backgrounds - clear layer separation */
    --bg-page: #18181b;
    --bg-card: #27272a;
    --bg-elevated: #3f3f46;
    --bg-tertiary: #52525b;

    /* Dark mode text - WCAG AAA compliant */
    --text-primary: #fafafa; /* 17.4:1 on #18181B */
    --text-secondary: #d4d4d8; /* 12.3:1 on #18181B */
    --text-muted: #a1a1aa; /* 7.1:1 on #18181B - AAA minimum */

    /* Dark mode borders */
    --border-default: #3f3f46;
    --border-strong: #52525b;
    --border-dark: #71717a;

    /* Dark mode brand */
    --brand-gunmetal: #9ca3af;
    --brand-gunmetal-light: #d1d5db;

    /* Dark mode CTA - adjusted for visibility */
    --cta-primary: #3b82f6; /* 4.7:1 - AA for large text */
    --cta-hover: #60a5fa;
    --cta-active: #93c5fd;

    /* Legacy compatibility */
    --accent: #9ca3af;
    --accent-hover: #d1d5db;
    --accent-muted: rgba(156, 163, 175, 0.15);
    --accent-emphasis: #fafaf9;

    /* Dark mode shadows */
    --shadow-card: 0 1px 3px rgba(0, 0, 0, 0.4);
    --shadow-card-hover: 0 8px 24px rgba(0, 0, 0, 0.5);
    --shadow-button: 0 1px 2px rgba(0, 0, 0, 0.2);
    --shadow-button-hover: 0 4px 12px rgba(59, 130, 246, 0.3);

    /* shadcn/ui compatibility - dark */
    --background: var(--bg-page);
    --foreground: var(--text-primary);
    --card: var(--bg-card);
    --card-foreground: var(--text-primary);
    --popover: var(--bg-card);
    --popover-foreground: var(--text-primary);
    --secondary: var(--bg-elevated);
    --secondary-foreground: var(--text-primary);
    --muted: var(--bg-elevated);
    --muted-foreground: var(--text-muted);
    --border: var(--border-default);
    --input: var(--border-default);
    --ring: var(--cta-primary);
  }

  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
    font-family:
      var(--font-inter),
      -apple-system,
      BlinkMacSystemFont,
      sans-serif;
    font-size: 16px;
    line-height: 1.625; /* leading-relaxed */
    color: var(--text-primary);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* ===============================================
     UNIFIED TYPOGRAPHY SCALE
     See: docs/DESIGN_TYPOGRAPHY.md for full spec
     
     Scale: H1 > H2 > H3 > H4 > Lead > Body > Small > Caption
     =============================================== */

  h1,
  .text-h1 {
    @apply text-3xl sm:text-4xl lg:text-5xl font-bold leading-tight tracking-tight;
    color: var(--text-primary);
  }

  h2,
  .text-h2 {
    @apply text-2xl sm:text-3xl font-semibold leading-snug;
    color: var(--text-primary);
  }

  h3,
  .text-h3 {
    @apply text-xl sm:text-2xl font-semibold leading-snug;
    color: var(--text-primary);
  }

  h4,
  .text-h4 {
    @apply text-lg sm:text-xl font-medium leading-normal;
    color: var(--text-primary);
  }

  .text-lead {
    @apply text-lg sm:text-xl font-normal leading-relaxed;
    color: var(--text-secondary);
  }

  .text-body {
    @apply text-base font-normal leading-relaxed;
    color: var(--text-primary);
  }

  .text-small {
    @apply text-sm font-normal leading-normal;
    color: var(--text-secondary);
  }

  .text-caption {
    @apply text-xs font-medium leading-tight;
    color: var(--text-muted);
  }

  /* ===============================================
     TEXT SELECTION - Critical dark mode fix
     Selected text was disappearing on dark backgrounds.
     =============================================== */
  ::selection {
    background-color: rgba(59, 130, 246, 0.3);
    color: var(--text-primary);
  }

  .dark ::selection {
    background-color: rgba(147, 197, 253, 0.35);
    color: #fafaf9;
  }

  /* ===============================================
     UNIFIED MICRO-INTERACTION SYSTEM
     
     Motion tokens used throughout:
     - --duration-fast: 150ms (buttons, hovers)
     - --duration-normal: 200ms (cards, menus)
     - --duration-slow: 300ms (page transitions)
     - --ease-default: cubic-bezier(0.16, 1, 0.3, 1)
     
     Respects prefers-reduced-motion for accessibility.
     =============================================== */

  /* Reduced motion: disable all transforms, keep color changes */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }

    .btn-primary:hover,
    .btn-secondary:hover,
    .card-interactive:hover {
      transform: none !important;
    }
  }

  /* ===============================================
     BUTTON INTERACTION PATTERNS
     
     Unified lift + shadow system:
     - Hover: -2px lift + enhanced shadow
     - Active: +1px press + reduced shadow
     - Focus: visible ring, no motion
     =============================================== */

  .btn-primary {
    transition:
      transform var(--duration-fast) var(--ease-hover),
      box-shadow var(--duration-fast) var(--ease-hover),
      background-color var(--duration-fast) var(--ease-hover);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-button-hover);
  }

  .btn-primary:active {
    transform: translateY(1px);
    box-shadow: var(--shadow-button);
  }

  .btn-primary:focus-visible {
    outline: 2px solid var(--cta-primary);
    outline-offset: 2px;
  }

  /* Secondary/Outline Button */
  .btn-secondary {
    transition:
      transform var(--duration-fast) var(--ease-hover),
      box-shadow var(--duration-fast) var(--ease-hover),
      background-color var(--duration-fast) var(--ease-hover),
      border-color var(--duration-fast) var(--ease-hover);
  }

  .btn-secondary:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .dark .btn-secondary:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
    border-color: var(--border-strong);
  }

  .btn-secondary:active {
    transform: translateY(0);
    box-shadow: none;
  }

  .btn-secondary:focus-visible {
    outline: 2px solid var(--cta-primary);
    outline-offset: 2px;
  }

  /* Ghost Button */
  .btn-ghost {
    transition:
      background-color var(--duration-fast) var(--ease-hover),
      color var(--duration-fast) var(--ease-hover);
  }

  .btn-ghost:hover {
    background-color: var(--bg-elevated);
  }

  .dark .btn-ghost:hover {
    background-color: var(--bg-tertiary);
  }

  /* ===============================================
     CARD & TILE INTERACTIONS
     
     Unified system: subtle shadow + optional lift
     Cards do NOT scale - only shadow changes
     =============================================== */

  .card-interactive {
    transition:
      box-shadow var(--duration-normal) var(--ease-default),
      border-color var(--duration-normal) var(--ease-default),
      transform var(--duration-normal) var(--ease-default);
    cursor: pointer;
  }

  .card-interactive:hover {
    box-shadow: var(--shadow-card-hover);
    border-color: var(--cta-primary);
  }

  .dark .card-interactive:hover {
    border-color: var(--border-strong);
  }

  .card-interactive:focus-visible {
    outline: 2px solid var(--cta-primary);
    outline-offset: 2px;
  }

  /* Card with lift effect (optional, use .card-lift) */
  .card-lift:hover {
    transform: translateY(-2px);
  }

  /* ===============================================
     NAVIGATION HOVER STATES
     Only the nav item itself should react, not parent.
     =============================================== */
  .nav-item {
    transition:
      background-color var(--duration-fast) var(--ease-hover),
      color var(--duration-fast) var(--ease-hover);
  }

  .nav-item:hover {
    background-color: var(--bg-secondary);
    color: var(--text-primary);
  }

  .dark .nav-item:hover {
    background-color: var(--bg-elevated);
    color: var(--text-primary);
  }

  .nav-item-active {
    background-color: var(--cta-primary);
    color: white;
  }

  /* ===============================================
     MOBILE MENU ANIMATION
     Slide-in from top with fade, respects reduced motion
     =============================================== */
  @keyframes mobile-menu-in {
    from {
      opacity: 0;
      transform: translateY(-16px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .mobile-menu-animate {
    animation: mobile-menu-in var(--duration-normal) var(--ease-default) forwards;
  }

  @media (prefers-reduced-motion: reduce) {
    .mobile-menu-animate {
      animation: none;
      opacity: 1;
      transform: none;
    }
  }

  /* ===============================================
     FADE-IN ANIMATION
     Gentle entrance animation for hero elements
     =============================================== */
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fade-in 0.6s var(--ease-default) forwards;
  }

  @media (prefers-reduced-motion: reduce) {
    .animate-fade-in {
      animation: none;
      opacity: 1;
      transform: none;
    }
  }

  /* ===============================================
     ACCESSIBILITY: LINKS - WCAG AAA Compliant
     Body text links MUST be underlined by default.
     Navigation and buttons use other visual cues.
     =============================================== */

  /* Prose links (paragraphs, articles) - ALWAYS underlined */
  .guide-article a,
  article a,
  p a,
  .prose a {
    color: var(--cta-primary);
    text-decoration: underline;
    text-underline-offset: 0.15em;
    text-decoration-thickness: 1px;
    font-weight: 500;
    transition: text-decoration-thickness 0.15s ease;
  }

  .guide-article a:hover,
  article a:hover,
  p a:hover,
  .prose a:hover {
    text-decoration-thickness: 2px;
  }

  /* Focus ring for accessibility - all interactive elements */
  a:focus-visible,
  button:focus-visible,
  [role="button"]:focus-visible,
  input:focus-visible,
  select:focus-visible,
  textarea:focus-visible {
    outline: 2px solid var(--cta-primary);
    outline-offset: 2px;
  }

  /* ===============================================
     MINIMUM FONT SIZE: 12px
     Ensure no text is smaller than 12px for accessibility
     =============================================== */
  .text-xs {
    font-size: 0.75rem !important; /* 12px minimum */
    line-height: 1.5;
  }

  /* Override any 10px or smaller text */
  .text-\[10px\],
  .text-\[11px\],
  .text-\[8px\] {
    font-size: 0.75rem !important; /* Force to 12px minimum */
    line-height: 1.5;
  }

  code,
  .sku,
  .code {
    font-family: ui-monospace, monospace;
    font-size: 14px;
  }

  .caption,
  figcaption {
    font-size: 12px; /* Minimum 12px */
    color: var(--text-muted);
  }
}

@layer components {
  /* ===============================================
     UNIFIED CONTAINER SYSTEM
     Standard max-width container for consistent alignment
     =============================================== */
  .container-narrow {
    @apply max-w-4xl mx-auto px-4 sm:px-6;
  }

  .container-wide {
    @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8;
  }

  /* ===============================================
     SECTION SPACING SYSTEM
     Consistent vertical rhythm between page sections
     =============================================== */
  .section-padding {
    @apply py-12 sm:py-16 lg:py-20;
  }

  .section-padding-sm {
    @apply py-8 sm:py-12;
  }

  /* ===============================================
     VALUE EXPLAINER COMPONENT
     Shows retail price → penny price conversion
     Used throughout the site for educational purposes
     =============================================== */
  .value-explainer {
    @apply bg-[var(--bg-elevated)] dark:bg-[var(--bg-card)] rounded-xl p-5 sm:p-6 border border-[var(--border-default)];
  }

  .value-explainer-header {
    @apply flex items-center justify-between mb-4;
  }

  .value-explainer-title {
    @apply text-lg font-semibold text-[var(--text-primary)];
  }

  .value-explainer-prices {
    @apply flex items-center gap-3 sm:gap-4;
  }

  .value-explainer-original {
    @apply text-lg sm:text-xl text-[var(--text-muted)] line-through;
  }

  .value-explainer-arrow {
    @apply text-[var(--text-muted)];
  }

  .value-explainer-penny {
    @apply text-2xl sm:text-3xl font-bold text-[var(--color-success)];
  }

  .value-explainer-savings {
    @apply mt-3 pt-3 border-t border-[var(--border-default)] text-sm text-[var(--text-secondary)];
  }

  .value-explainer-badge {
    @apply inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold bg-[var(--color-success)]/10 text-[var(--color-success)];
  }

  /* ===============================================
     PENNY VALUE BADGES
     Status indicators for clearance stages
     =============================================== */
  .badge-penny {
    @apply inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold;
    @apply bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300;
  }

  .badge-clearance {
    @apply inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold;
    @apply bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300;
  }

  .badge-markdown {
    @apply inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold;
    @apply bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300;
  }

  .badge-info {
    @apply inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold;
    @apply bg-stone-100 dark:bg-stone-800 text-stone-600 dark:text-stone-300;
  }

  /* ===============================================
     MARKDOWN PATH DISPLAY
     Visual representation of price markdown stages
     =============================================== */
  .markdown-path {
    @apply flex items-center gap-2 flex-wrap;
  }

  .markdown-step {
    @apply inline-flex items-center gap-1.5;
  }

  .markdown-price {
    @apply px-2 py-0.5 rounded text-sm font-mono font-medium;
    @apply bg-stone-100 dark:bg-stone-800 text-stone-700 dark:text-stone-300;
  }

  .markdown-price.active {
    @apply bg-[var(--cta-primary)] text-white;
  }

  .markdown-price.penny {
    @apply bg-emerald-500 text-white;
  }

  .markdown-arrow {
    @apply text-stone-400 dark:text-stone-500 text-xs;
  }

  /* ===============================================
     TOOLTIP SYSTEM
     Accessible tooltips for educational content
     =============================================== */
  .tooltip-trigger {
    @apply relative inline-flex items-center cursor-help;
    @apply underline decoration-dotted decoration-[var(--text-muted)] underline-offset-2;
  }

  .tooltip-content {
    @apply absolute z-50 px-3 py-2 text-sm rounded-lg shadow-lg;
    @apply bg-stone-900 dark:bg-stone-100 text-white dark:text-stone-900;
    @apply max-w-xs w-max;
    @apply opacity-0 invisible transition-all duration-150;
    @apply bottom-full left-1/2 -translate-x-1/2 mb-2;
  }

  .tooltip-trigger:hover .tooltip-content,
  .tooltip-trigger:focus .tooltip-content {
    @apply opacity-100 visible;
  }

  /* Mobile-friendly: show on tap */
  @media (max-width: 640px) {
    .tooltip-content {
      @apply left-0 translate-x-0 max-w-[calc(100vw-2rem)];
    }
  }

  /* ===============================================
     GUIDE ARTICLE STYLES
     =============================================== */
  .guide-article {
    @apply text-[var(--text-secondary)];
  }

  .guide-article p {
    @apply mb-4 leading-relaxed;
  }

  .guide-article ul {
    @apply mb-6 ml-6 space-y-2 list-disc;
  }

  .guide-article li {
    @apply leading-relaxed;
  }

  .guide-article strong {
    @apply text-[var(--text-primary)] font-semibold;
  }

  /* Section Headings - unified with type scale */
  .section-heading {
    @apply text-xl sm:text-2xl font-semibold text-[var(--text-primary)] mb-6 pb-3 border-b border-[var(--border-default)] flex items-center gap-3;
  }

  .lead {
    @apply text-lg text-stone-600 dark:text-stone-300 mb-6;
  }

  /* ===============================================
     CALLOUT BOXES
     =============================================== */
  .callout {
    @apply rounded-xl p-5 mb-6 border;
  }

  .callout-sky {
    @apply bg-sky-50 dark:bg-sky-950/30 border-sky-200 dark:border-sky-800;
  }

  .callout-amber {
    @apply bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800;
  }

  .callout-emerald {
    @apply bg-emerald-50 dark:bg-emerald-950/30 border-emerald-200 dark:border-emerald-800;
  }

  .callout-rose {
    @apply bg-rose-50 dark:bg-rose-950/30 border-rose-200 dark:border-rose-800;
  }

  .callout-compact {
    @apply p-4;
  }

  /* ===============================================
     PRICE CHIPS
     =============================================== */
  .price-chip {
    @apply inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-mono font-medium;
    @apply bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300;
  }

  /* ===============================================
     STEP CARDS (for numbered steps)
     =============================================== */
  .step-card {
    @apply relative pl-10 py-3;
  }

  .step-badge {
    @apply absolute left-0 top-3 w-7 h-7 rounded flex items-center justify-center text-xs font-bold;
    @apply bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300;
  }

  /* ===============================================
     INFO CARDS
     =============================================== */
  .info-card {
    @apply bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-4;
  }

  .info-card-header {
    @apply flex items-center gap-2.5 mb-2;
  }

  .info-card-icon {
    @apply w-8 h-8 rounded flex items-center justify-center;
    @apply bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400;
  }

  .info-card-title {
    @apply text-sm font-semibold text-slate-900 dark:text-white;
  }

  /* ===============================================
     TABLES ENHANCEMENT
     =============================================== */
  .guide-article table {
    @apply w-full mb-8 rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700;
  }

  .guide-article thead {
    @apply bg-slate-50 dark:bg-slate-800/50;
  }

  .guide-article th {
    @apply text-left px-4 py-3 text-xs font-semibold text-slate-600 dark:text-slate-300 uppercase tracking-wider;
  }

  .guide-article td {
    @apply px-4 py-3 text-sm border-t border-slate-100 dark:border-slate-700/50;
  }

  .guide-article tbody tr {
    @apply bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors;
  }

  /* ===============================================
     STATUS BADGES
     =============================================== */
  .status-high {
    @apply text-emerald-600 dark:text-emerald-400 font-medium;
  }

  .status-medium {
    @apply text-amber-600 dark:text-amber-400 font-medium;
  }

  .status-low {
    @apply text-rose-600 dark:text-rose-400 font-medium;
  }

  /* ===============================================
     PRIORITY BADGES (WCAG AA compliant)
     =============================================== */
  .priority-badge {
    @apply inline-flex items-center px-2 py-0.5 rounded text-xs font-medium;
  }

  .priority-badge.high {
    @apply bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300;
  }

  .priority-badge.medium {
    @apply bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300;
  }

  .priority-badge.low {
    @apply bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400;
  }

  .priority-badge.penny {
    @apply bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300;
  }

  /* ===============================================
     LEAFLET MAP POPUP OVERRIDES
     Ensures popup is always visible, high contrast,
     and consistent with the design system.
     =============================================== */

  /* Popup container styling - Light mode */
  .leaflet-popup-content-wrapper {
    @apply bg-white rounded-xl shadow-lg border border-slate-200;
    padding: 0;
    overflow: hidden;
  }

  .leaflet-popup-content {
    margin: 14px 16px;
    line-height: 1.5;
    font-size: 14px; /* Minimum 12px, using 14px for readability */
    color: #0f172a; /* slate-900 */
  }

  /* Popup tip (arrow) styling - Light mode */
  .leaflet-popup-tip-container {
    margin-top: -1px;
  }

  .leaflet-popup-tip {
    @apply bg-white border border-slate-200;
    box-shadow: none;
  }

  /* Close button styling - Light mode */
  .leaflet-popup-close-button {
    color: #64748b !important; /* slate-500 */
    font-size: 20px !important;
    font-weight: 400 !important;
    width: 28px !important;
    height: 28px !important;
    top: 8px !important;
    right: 8px !important;
    padding: 0 !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    transition:
      background-color 0.15s ease,
      color 0.15s ease;
  }

  .leaflet-popup-close-button:hover {
    color: #0f172a !important; /* slate-900 */
    background-color: #f1f5f9 !important; /* slate-100 */
  }

  /* ===============================================
     DARK MODE POPUP OVERRIDES
     =============================================== */
  .dark .leaflet-popup-content-wrapper {
    @apply bg-slate-800 border-slate-700;
  }

  .dark .leaflet-popup-content {
    color: #f8fafc; /* slate-50 */
  }

  .dark .leaflet-popup-tip {
    @apply bg-slate-800 border-slate-700;
  }

  .dark .leaflet-popup-close-button {
    color: #94a3b8 !important; /* slate-400 */
  }

  .dark .leaflet-popup-close-button:hover {
    color: #f8fafc !important; /* slate-50 */
    background-color: #334155 !important; /* slate-700 */
  }

  /* Ensure popup links have clear hover states */
  .store-popup-link {
    text-decoration: none;
    transition:
      color 0.15s ease,
      text-decoration 0.15s ease;
  }

  .store-popup-link:hover {
    text-decoration: underline;
  }

  /* Prevent popup from hugging edges - add margin to popup pane */
  .leaflet-popup {
    margin-bottom: 10px;
  }
}
