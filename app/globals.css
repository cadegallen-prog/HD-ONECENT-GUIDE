@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* ===============================================
       PENNY CENTRAL – UNIFIED DESIGN SYSTEM
       60-30-10 Rule: Neutral-Brand-CTA
       WCAG AAA Compliant Typography & Colors
       See: docs/DESIGN-SYSTEM-AAA.md
       =============================================== */

    /* ===============================================
       MOTION TOKENS
       Consistent animation timing across components
       =============================================== */
    --duration-fast: 150ms;
    --duration-normal: 200ms;
    --duration-slow: 240ms;
    --ease-default: cubic-bezier(0.16, 1, 0.3, 1);
    --ease-hover: ease-out;
    --ease-tap: ease-in;

    /* ===============================================
       UTILITY CLASSES
       =============================================== */

    /* ===============================================
       COLOR TOKENS
       =============================================== */

    /* 60% - NEUTRAL BASE (backgrounds, text) */
    --bg-page: #ffffff;
    --bg-elevated: #fafaf9;
    --bg-recessed: #f5f5f4;
    --bg-hover: #f0efed;
    --bg-focus: #f0efed;
    --bg-card: var(--bg-elevated);
    --bg-modal: var(--bg-elevated);
    --bg-tertiary: var(--bg-recessed);

    /* Legacy aliases for compatibility */
    --bg-primary: var(--bg-page);
    --bg-secondary: var(--bg-elevated);
    --bg-dark: #1c1917;

    /* WCAG AAA compliant text colors (7:1+ contrast) */
    --text-primary: #1c1917;
    --text-secondary: #44403c;
    --text-muted: #57534e;
    --text-placeholder: #78716c;
    --text-inverse: #ffffff;

    --border-default: #e7e5e4;
    --border-strong: #d6d3d1;
    --border-focus: #1d4ed8;
    --border-dark: #d6d3d1;

    /* Brand neutrals (align to text palette) */
    --brand-gunmetal: var(--text-secondary);
    --brand-gunmetal-light: var(--text-muted);
    --brand-copper: var(--text-secondary);
    --brand-bronze: var(--text-muted);

    /* 10% - CTA ACCENT (clickable elements ONLY) */
    --cta-primary: #1d4ed8; /* 8.6:1 contrast - AAA */
    --cta-hover: #1e40af;
    --cta-active: #1e3a8a;
    --cta-text: #ffffff;

    /* SYSTEM COLORS */
    --status-success: #15803d;
    --status-warning: #a16207;
    --status-error: #b91c1c;
    --status-info: #1d4ed8;
    --color-success: var(--status-success);
    --color-warning: var(--status-warning);
    --color-error: var(--status-error);
    --color-info: var(--status-info);

    /* Legacy status aliases */
    --success: var(--status-success);
    --error: var(--status-error);
    --warning: var(--status-warning);

    /* Shadows */
    --shadow-card: 0 1px 3px rgba(0, 0, 0, 0.08);
    --shadow-card-hover: 0 3px 8px rgba(0, 0, 0, 0.12);
    --shadow-button: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-button-hover: 0 3px 8px rgba(29, 78, 216, 0.18);

    /* Live indicator */
    --live-indicator: #d97706;
    --live-glow: rgba(217, 119, 6, 0.4);

    /* Accent system aligns to CTA blue */
    --accent: var(--cta-primary);
    --accent-hover: var(--cta-hover);
    /* Fallback for browsers without color-mix */
    --accent-muted: #e4eafa;
    --accent-emphasis: var(--cta-active);
    --accent-foreground: var(--cta-text);

    /* Map + chip system */
    --chip-surface: var(--bg-elevated);
    --chip-surface-strong: var(--bg-page);
    --chip-border: var(--border-default);
    /* Fallbacks preceding color-mix for broader support */
    --chip-accent-surface: #e5ecfb;
    --chip-accent-border: #c4d2f3;
    --chip-success-surface: #dae6df;
    --chip-success-border: #b8d6c4;
    --chip-muted-surface: var(--bg-recessed);
    --chip-muted-border: var(--border-default);
    --map-marker-default: var(--brand-gunmetal);
    --map-marker-selected: var(--cta-primary);
    --map-marker-outline: #ffffff;
    --map-marker-core: var(--bg-page);

    /* shadcn/ui compatibility */
    --background: var(--bg-page);
    --foreground: var(--text-primary);
    --card: var(--bg-card);
    --card-foreground: var(--text-primary);
    --popover: var(--bg-elevated);
    --popover-foreground: var(--text-primary);
    --primary: var(--cta-primary);
    --primary-foreground: var(--cta-text);
    --secondary: var(--bg-recessed);
    --secondary-foreground: var(--text-primary);
    --muted: var(--bg-recessed);
    --muted-foreground: var(--text-muted);
    --destructive: var(--status-error);
    --destructive-foreground: #ffffff;
    --border: var(--border-default);
    --input: var(--border-strong);
    --ring: var(--border-focus);
    --radius: 0.5rem;
  }

  .dark {
    /* ===============================================
       PHASE 1: HALATION MITIGATION & WCAG FOUNDATION
       Base surface: #121212 (Material Design standard)
       Desaturated content colors for reduced eye strain
       All colors meet WCAG 2.2 Level AA minimum
       =============================================== */

    /* TONAL ELEVATION SYSTEM (0-6 dp)
       Depth is achieved through color (lightening), not shadows
       Each level represents increasing visual prominence */

    /* Level 0: Base surface - Foundation layer */
    --bg-page: #121212; /* Material Design dark grey - halation mitigation */

    /* Level 1-2: Standard components (cards, buttons) */
    --bg-card: #1a1a1a; /* +8 luminance from base - cards, repeating elements */
    --bg-elevated: #1f1f1f; /* slightly brighter than cards for subtle lift */
    --bg-recessed: #1a1a1a; /* form fields and muted surfaces */

    /* Level 3-4: Interactive states (hover, focus) */
    --bg-hover: #242424; /* hover/active states */
    --bg-focus: #2a2a2a; /* focused elements */

    /* Level 5-6: Modals and highest priority */
    --bg-modal: #303030; /* dialogs, overlays */
    --bg-tertiary: #3a3a3a; /* maximum elevation */
    --bg-primary: var(--bg-page);
    --bg-secondary: var(--bg-elevated);
    --bg-dark: var(--bg-page);

    /* DESATURATED TEXT COLORS (4.5:1 minimum on respective surfaces)
       Using muted warm grays instead of pure white to reduce optical vibration */

    /* Primary content: Must meet 4.5:1 on Level 1 cards (#1a1a1a) */
    --text-primary: #dcdcdc; /* 12.7:1 on #1a1a1a, 13.6:1 on #121212 (AAA) */

    /* Secondary content: Must meet 4.5:1 on Level 1 cards */
    --text-secondary: #b0b0b0; /* 8.0:1 on #1a1a1a (AAA) */

    /* Tertiary content: Must meet 4.5:1 on Level 1 cards */
    --text-muted: #9a9a9a; /* 6.2:1 on #1a1a1a (AA+) */
    --text-placeholder: #78716c;

    /* Inverse text for light buttons */
    --text-inverse: #030712;

    /* UI COMPONENT BORDERS (3:1 minimum against adjacent surfaces)
       Cards on base: border must have 3:1 against #121212 */
    --border-default: #6b6b6b; /* 3.3:1 on #121212, 3.3:1 on #1a1a1a */
    --border-strong: #747474; /* 3.7:1 on #121212, 3.7:1 on #1a1a1a */
    --border-dark: #808080; /* 4.4:1 on #121212, 4.4:1 on #1a1a1a */
    --border-focus: #60a5fa;

    /* Dark mode brand - desaturated */
    --brand-gunmetal: var(--text-secondary);
    --brand-gunmetal-light: var(--text-muted);
    --brand-copper: var(--text-secondary);
    --brand-bronze: var(--text-muted);

    /* CTA ACCENT - Desaturated blue for 4.5:1 text contrast
       Must work as text color on dark surfaces AND as button background */
    --cta-primary: #60a5fa; /* Blue 400 - 4.8:1 on #121212 base (meets AA for text) */
    --cta-text: #030712; /* Near-black for light button text */
    --cta-hover: #93c5fd; /* Blue 300 - 6.2:1 on base */
    --cta-active: #bfdbfe; /* Blue 200 - 8.1:1 on base */
    --link-default: #60a5fa;
    --link-hover: #93c5fd;

    /* STATUS COLORS - Desaturated for dark mode, must meet 4.5:1 on base */
    --status-success: #4ade80; /* Green 400 - 5.1:1 on #121212 */
    --status-warning: #fbbf24; /* Amber 400 - 8.3:1 on #121212 */
    --status-error: #f87171; /* Red 400 - 4.7:1 on #121212 */
    --status-info: #60a5fa; /* Blue 400 - matches CTA */

    /* LIVE INDICATOR - Special case, decorative element */
    --live-indicator: #fbbf24; /* Amber 400 - warm, energetic */
    --live-glow: rgba(251, 191, 36, 0.4);

    /* Legacy compatibility */
    --accent: #60a5fa;
    --accent-hover: #93c5fd;
    --accent-muted: #9fc4fb;
    --accent-emphasis: #bfdbfe;

    /* Map + chip system overrides */
    --chip-accent-surface: #bed5fb;
    --chip-accent-border: #7bb0f6;
    --chip-success-surface: #bfeccd;
    --chip-success-border: #7bd49a;
    --chip-muted-surface: var(--bg-hover);
    --chip-muted-border: var(--border-strong);
    --map-marker-outline: #f3f4f6;
    --map-marker-core: var(--bg-card);

    /* Dark mode shadows - Subtle, 8px max blur per design system */
    --shadow-card: 0 1px 3px rgba(0, 0, 0, 0.5);
    --shadow-card-hover: 0 3px 8px rgba(0, 0, 0, 0.5);
    --shadow-button: 0 1px 2px rgba(0, 0, 0, 0.3);
    --shadow-button-hover: 0 3px 8px rgba(96, 165, 250, 0.25);

    /* shadcn/ui compatibility - dark mode with elevation system */
    --background: var(--bg-page); /* Level 0 */
    --foreground: var(--text-primary);
    --card: var(--bg-card); /* Level 1-2 */
    --card-foreground: var(--text-primary);
    --popover: var(--bg-elevated); /* Level 2 */
    --popover-foreground: var(--text-primary);
    --secondary: var(--bg-elevated); /* Level 2 */
    --secondary-foreground: var(--text-primary);
    --muted: var(--bg-hover); /* Level 3 */
    --muted-foreground: var(--text-muted);
    --destructive: var(--status-error);
    --destructive-foreground: #030712;
    --border: var(--border-default);
    --input: var(--border-strong);
    --ring: var(--border-focus);
  }

  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
    font-family:
      var(--font-inter),
      -apple-system,
      BlinkMacSystemFont,
      sans-serif;
    font-size: 16px;
    line-height: 1.7; /* Increased from 1.625 for dark mode readability */
    color: var(--text-primary);
    font-weight: 400; /* Explicit Regular weight - never thinner */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* ===============================================
     TONAL ELEVATION UTILITY CLASSES
     Apply semantic elevation levels to components
     Cards, buttons, and interactive elements
     =============================================== */

  .elevation-0 {
    background-color: var(--bg-page);
  }

  .elevation-1,
  .elevation-card {
    background-color: var(--bg-card);
  }

  .elevation-2 {
    background-color: var(--bg-elevated);
  }

  .elevation-3,
  .elevation-hover {
    background-color: var(--bg-hover);
  }

  .elevation-4,
  .elevation-focus {
    background-color: var(--bg-focus);
  }

  .elevation-5,
  .elevation-modal {
    background-color: var(--bg-modal);
  }

  .elevation-6 {
    background-color: var(--bg-tertiary);
  }

  /* ===============================================
     8-POINT GRID SPACING SYSTEM
     Ensures consistent, device-agnostic scaling
     All spacing divisible by 8px (8, 16, 24, 32, 40, 48...)
     Prevents sub-pixel rendering and scaling issues
     =============================================== */

  :root {
    --space-1: 0.5rem; /* 8px */
    --space-2: 1rem; /* 16px */
    --space-3: 1.5rem; /* 24px */
    --space-4: 2rem; /* 32px */
    --space-5: 2.5rem; /* 40px */
    --space-6: 3rem; /* 48px */
    --space-8: 4rem; /* 64px */
    --space-10: 5rem; /* 80px */
    --space-12: 6rem; /* 96px */
  }

  /* Tailwind already uses 8pt grid (p-4 = 16px, p-6 = 24px, p-8 = 32px)
     These CSS variables provide explicit semantic spacing */

  /* ===============================================
     UNIFIED TYPOGRAPHY SCALE
     See: docs/DESIGN_TYPOGRAPHY.md for full spec
     
     Scale: H1 > H2 > H3 > H4 > Lead > Body > Small > Caption
     Font weights: Never below 400 (Regular) for readability
     Line heights: Increased for dark mode comfort (1.7 base)
     =============================================== */

  h1,
  .text-h1 {
    @apply text-3xl sm:text-4xl lg:text-5xl font-bold leading-tight tracking-tight;
    color: var(--text-primary);
    font-weight: 700; /* Explicit bold for maximum clarity */
    line-height: 1.2;
  }

  h2,
  .text-h2 {
    @apply text-2xl sm:text-3xl font-semibold leading-snug;
    color: var(--text-primary);
    font-weight: 600; /* Semibold minimum */
    line-height: 1.3;
  }

  h3,
  .text-h3 {
    @apply text-xl sm:text-2xl font-semibold leading-snug;
    color: var(--text-primary);
    font-weight: 600; /* Semibold minimum */
    line-height: 1.4;
  }

  h4,
  .text-h4 {
    @apply text-lg sm:text-xl font-medium leading-normal;
    color: var(--text-primary);
    font-weight: 500; /* Medium minimum */
    line-height: 1.5;
  }

  .text-lead {
    @apply text-lg sm:text-xl font-normal leading-relaxed;
    color: var(--text-secondary);
    font-weight: 400; /* Regular - never lighter */
    line-height: 1.7;
  }

  .text-body {
    @apply text-base font-normal leading-relaxed;
    color: var(--text-primary);
    font-weight: 400; /* Regular - never lighter */
    line-height: 1.7; /* Increased for dark mode */
  }

  .text-small {
    @apply text-sm font-normal leading-normal;
    color: var(--text-secondary);
    font-weight: 400; /* Regular - never lighter */
    line-height: 1.6;
  }

  .text-caption {
    @apply text-xs font-medium leading-tight;
    color: var(--text-muted);
    font-weight: 500; /* Medium for small text legibility */
    line-height: 1.5; /* Slightly relaxed for better scanning */
  }

  /* ===============================================
     TEXT SELECTION - Critical dark mode fix
     Selected text was disappearing on dark backgrounds.
     =============================================== */
  ::selection {
    background-color: rgba(29, 78, 216, 0.3); /* Fallback */
    color: var(--text-primary);
  }

  .dark ::selection {
    background-color: rgba(147, 197, 253, 0.35); /* Fallback */
    color: var(--text-primary);
  }

  /* ===============================================
     UNIFIED MICRO-INTERACTION SYSTEM
     
     Motion tokens used throughout:
     - --duration-fast: 150ms (buttons, hovers)
     - --duration-normal: 200ms (cards, menus)
     - --duration-slow: 300ms (page transitions)
     - --ease-default: cubic-bezier(0.16, 1, 0.3, 1)
     
     Respects prefers-reduced-motion for accessibility.
     =============================================== */

  /* Reduced motion: disable all transforms, keep color changes */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }

    .btn-primary:hover,
    .btn-secondary:hover,
    .card-interactive:hover {
      transform: none !important;
    }
  }

  /* ===============================================
     BUTTON INTERACTION PATTERNS
     
     Unified lift + shadow system:
     - Hover: -2px lift + enhanced shadow
     - Active: +1px press + reduced shadow
     - Focus: visible ring, no motion
     =============================================== */

  .btn-primary {
    box-shadow: var(--shadow-button);
    transition:
      background-color var(--duration-fast) var(--ease-hover),
      box-shadow var(--duration-fast) var(--ease-hover);
  }

  .btn-primary:hover {
    background-color: var(--cta-hover);
    box-shadow: var(--shadow-button-hover);
  }

  .btn-primary:active {
    background-color: var(--cta-active);
    box-shadow: var(--shadow-button);
  }

  .btn-primary:focus-visible {
    outline: 2px solid var(--cta-primary);
    outline-offset: 2px;
  }

  /* Secondary/Outline Button */
  .btn-secondary {
    transition:
      background-color var(--duration-fast) var(--ease-hover),
      border-color var(--duration-fast) var(--ease-hover),
      box-shadow var(--duration-fast) var(--ease-hover);
  }

  .btn-secondary:hover {
    background-color: var(--bg-hover);
    border-color: var(--border-strong);
    box-shadow: var(--shadow-card);
  }

  .dark .btn-secondary:hover {
    background-color: var(--bg-hover);
    border-color: var(--border-strong);
    box-shadow: var(--shadow-card-hover);
  }

  .btn-secondary:active {
    background-color: var(--bg-elevated);
    box-shadow: var(--shadow-card);
  }

  .btn-secondary:focus-visible {
    outline: 2px solid var(--cta-primary);
    outline-offset: 2px;
  }

  /* Ghost Button */
  .btn-ghost {
    transition:
      background-color var(--duration-fast) var(--ease-hover),
      color var(--duration-fast) var(--ease-hover);
  }

  .btn-ghost:hover {
    background-color: var(--bg-elevated);
  }

  .dark .btn-ghost:hover {
    background-color: var(--bg-tertiary);
  }

  /* ===============================================
     CARD & TILE INTERACTIONS
     
     Unified system: subtle shadow + optional lift
     Cards do NOT scale - only shadow changes
     =============================================== */

  .card-interactive {
    transition:
      box-shadow var(--duration-fast) var(--ease-default),
      border-color var(--duration-fast) var(--ease-default),
      background-color var(--duration-fast) var(--ease-default);
    cursor: pointer;
  }

  .card-interactive:hover {
    box-shadow: var(--shadow-card-hover);
    border-color: var(--border-strong);
    background-color: var(--bg-elevated);
  }

  .dark .card-interactive:hover {
    border-color: var(--border-strong);
    background-color: var(--bg-hover);
  }

  .card-interactive:focus-visible {
    outline: 2px solid var(--cta-primary);
    outline-offset: 2px;
  }

  /* Card with lift effect (optional, use .card-lift) */
  .card-lift:hover {
    box-shadow: var(--shadow-card-hover);
  }

  /* ===============================================
     MAP MARKER ANIMATIONS
     Smooth scale and shadow on hover
     =============================================== */
  .map-marker-default,
  .map-marker-selected {
    background: transparent;
    border: none;
  }

  .map-marker-default svg,
  .map-marker-selected svg {
    transition:
      transform var(--duration-normal) cubic-bezier(0.175, 0.885, 0.32, 1.275),
      filter var(--duration-normal) ease;
    transform-origin: bottom center;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
  }

  .map-marker-default:hover svg {
    transform: scale(1.15);
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
    z-index: 1000;
  }

  .map-marker-selected:hover svg {
    transform: scale(1.1);
  }

  @media (prefers-reduced-motion: reduce) {
    .map-marker-default svg,
    .map-marker-selected svg {
      transition: none;
      transform: none;
    }

    .map-marker-default:hover svg,
    .map-marker-selected:hover svg {
      transform: none;
    }
  }

  /* ===============================================
     NAVIGATION HOVER STATES
     Only the nav item itself should react, not parent.
     =============================================== */
  .nav-item {
    transition:
      background-color var(--duration-fast) var(--ease-hover),
      color var(--duration-fast) var(--ease-hover);
  }

  .nav-item:hover {
    background-color: var(--bg-secondary);
    color: var(--text-primary);
  }

  .dark .nav-item:hover {
    background-color: var(--bg-elevated);
    color: var(--text-primary);
  }

  .nav-item-active {
    background-color: var(--cta-primary);
    color: white;
  }

  /* ===============================================
     MOBILE MENU ANIMATION
     Slide-in from top with fade, respects reduced motion
     =============================================== */
  @keyframes mobile-menu-in {
    from {
      opacity: 0;
      transform: translateY(-12px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .mobile-menu-animate {
    animation: mobile-menu-in var(--duration-fast) var(--ease-default) forwards;
  }

  @media (prefers-reduced-motion: reduce) {
    .mobile-menu-animate {
      animation: none;
      opacity: 1;
      transform: none;
    }
  }

  /* ===============================================
     FADE-IN ANIMATION
     Gentle entrance animation for hero elements
     =============================================== */
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fade-in var(--duration-fast) var(--ease-default) forwards;
  }

  @media (prefers-reduced-motion: reduce) {
    .animate-fade-in {
      animation: none;
      opacity: 1;
      transform: none;
    }
  }

  /* ===============================================
     ACCESSIBILITY: LINKS - WCAG AAA Compliant
     Body text links MUST be underlined by default.
     Navigation and buttons use other visual cues.
     =============================================== */

  /* Prose links (paragraphs, articles) - ALWAYS underlined */
  .guide-article a,
  article a,
  p a,
  .prose a {
    color: var(--cta-primary);
    text-decoration: underline;
    text-underline-offset: 0.15em;
    text-decoration-thickness: 1px;
    font-weight: 500;
    transition: text-decoration-thickness 0.15s ease;
  }

  .guide-article a:hover,
  article a:hover,
  p a:hover,
  .prose a:hover {
    text-decoration-thickness: 2px;
  }

  /* Focus ring for accessibility - all interactive elements */
  a:focus-visible,
  button:focus-visible,
  [role="button"]:focus-visible,
  input:focus-visible,
  select:focus-visible,
  textarea:focus-visible {
    outline: 2px solid var(--cta-primary);
    outline-offset: 2px;
  }

  /* ===============================================
     MINIMUM FONT SIZE: 12px
     Ensure no text is smaller than 12px for accessibility
     =============================================== */
  .text-xs {
    font-size: 0.75rem !important; /* 12px minimum */
    line-height: 1.5;
  }

  /* Override any 10px or smaller text */
  .text-\[10px\],
  .text-\[11px\],
  .text-\[8px\] {
    font-size: 0.75rem !important; /* Force to 12px minimum */
    line-height: 1.5;
  }

  code,
  .sku,
  .code {
    font-family: ui-monospace, monospace;
    font-size: 14px;
  }

  .caption,
  figcaption {
    font-size: 12px; /* Minimum 12px */
    color: var(--text-muted);
  }
}

@layer components {
  /* ===============================================
     UNIFIED CONTAINER SYSTEM
     Standard max-width container for consistent alignment
     =============================================== */
  .container-narrow {
    @apply max-w-4xl mx-auto px-4 sm:px-6;
  }

  .container-wide {
    @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8;
  }

  /* ===============================================
     SECTION SPACING SYSTEM
     Consistent vertical rhythm between page sections
     =============================================== */
  .section-padding {
    @apply py-12 sm:py-16 lg:py-20;
  }

  .section-padding-sm {
    @apply py-8 sm:py-12;
  }

  /* ===============================================
     VALUE EXPLAINER COMPONENT
     Shows retail price → penny price conversion
     Used throughout the site for educational purposes
     =============================================== */
  .value-explainer {
    @apply bg-[var(--bg-elevated)] dark:bg-[var(--bg-card)] rounded-xl p-5 sm:p-6 border border-[var(--border-default)];
  }

  .value-explainer-header {
    @apply flex items-center justify-between mb-4;
  }

  .value-explainer-title {
    @apply text-lg font-semibold text-[var(--text-primary)];
  }

  .value-explainer-prices {
    @apply flex items-center gap-3 sm:gap-4;
  }

  .value-explainer-original {
    @apply text-lg sm:text-xl text-[var(--text-muted)] line-through;
  }

  .value-explainer-arrow {
    @apply text-[var(--text-muted)];
  }

  .value-explainer-penny {
    @apply text-2xl sm:text-3xl font-bold text-[var(--color-success)];
  }

  .value-explainer-savings {
    @apply mt-3 pt-3 border-t border-[var(--border-default)] text-sm text-[var(--text-secondary)];
  }

  .value-explainer-badge {
    @apply inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold bg-[var(--color-success)]/10 text-[var(--color-success)];
  }

  /* ===============================================
     PENNY VALUE BADGES
     Status indicators for clearance stages
     =============================================== */
  .badge-penny {
    @apply inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold;
    background-color: var(--bg-elevated);
    color: var(--status-success);
    border: 1px solid var(--status-success);
  }

  .badge-clearance {
    @apply inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold border;
    background-color: var(--bg-elevated);
    color: var(--status-warning);
    border-color: var(--status-warning);
  }

  .badge-markdown {
    @apply inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold;
    background-color: var(--bg-elevated);
    color: var(--status-info);
    border: 1px solid var(--status-info);
  }

  .badge-info {
    @apply inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-semibold;
    background-color: var(--bg-recessed);
    color: var(--text-secondary);
    border: 1px solid var(--border-default);
  }

  /* ===============================================
     MARKDOWN PATH DISPLAY
     Visual representation of price markdown stages
     =============================================== */
  .markdown-path {
    @apply flex items-center gap-2 flex-wrap;
  }

  .markdown-step {
    @apply inline-flex items-center gap-1.5;
  }

  .markdown-price {
    @apply px-2 py-0.5 rounded text-sm font-mono font-medium;
    background-color: var(--bg-elevated);
    color: var(--text-primary);
    border: 1px solid var(--border-default);
  }

  .markdown-price.active {
    @apply bg-[var(--cta-primary)] text-[var(--cta-text)];
  }

  .markdown-price.penny {
    background-color: var(--status-success);
    color: var(--text-inverse);
  }

  .markdown-arrow {
    color: var(--text-muted);
    font-size: 0.75rem;
  }

  /* ===============================================
     TOOLTIP SYSTEM
     Accessible tooltips for educational content
     =============================================== */
  .tooltip-trigger {
    @apply relative inline-flex items-center cursor-help;
    @apply underline decoration-dotted decoration-[var(--text-muted)] underline-offset-2;
  }

  .tooltip-content {
    @apply absolute z-50 px-3 py-2 text-sm rounded-lg shadow-lg;
    background-color: var(--bg-card);
    color: var(--text-primary);
    border: 1px solid var(--border-default);
    @apply max-w-xs w-max;
    @apply opacity-0 invisible transition-all duration-150;
    @apply bottom-full left-1/2 -translate-x-1/2 mb-2;
  }

  .tooltip-trigger:hover .tooltip-content,
  .tooltip-trigger:focus .tooltip-content {
    @apply opacity-100 visible;
  }

  /* Mobile-friendly: show on tap */
  @media (max-width: 640px) {
    .tooltip-content {
      @apply left-0 translate-x-0 max-w-[calc(100vw-2rem)];
    }
  }

  /* ===============================================
     GUIDE ARTICLE STYLES
     =============================================== */
  .guide-article {
    @apply text-[var(--text-secondary)];
  }

  .guide-article p {
    @apply mb-4 leading-relaxed;
  }

  .guide-article ul {
    @apply mb-6 ml-6 space-y-2 list-disc;
  }

  .guide-article li {
    @apply leading-relaxed;
  }

  .guide-article strong {
    @apply text-[var(--text-primary)] font-semibold;
  }

  /* Section Headings - unified with type scale */
  .section-heading {
    @apply text-xl sm:text-2xl font-semibold text-[var(--text-primary)] mb-6 pb-3 border-b border-[var(--border-default)] flex items-center gap-3;
  }

  .lead {
    @apply text-lg mb-6;
    color: var(--text-secondary);
  }

  /* ===============================================
     CALLOUT BOXES
     =============================================== */
  .callout {
    @apply rounded-xl p-5 mb-6 border;
    background-color: var(--bg-elevated);
    border-color: var(--border-default);
    color: var(--text-secondary);
  }

  .callout-sky {
    background-color: var(--bg-elevated);
    border-color: var(--status-info);
  }

  .callout-amber {
    background-color: var(--bg-elevated);
    border-color: var(--status-warning);
    color: var(--text-secondary);
  }

  .callout-emerald {
    background-color: var(--bg-elevated);
    border-color: var(--status-success);
  }

  .callout-rose {
    background-color: var(--bg-elevated);
    border-color: var(--status-error);
  }

  .callout-compact {
    @apply p-4;
  }

  /* ===============================================
     PRICE CHIPS
     =============================================== */
  .price-chip {
    @apply inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-mono font-medium;
    background-color: var(--bg-elevated);
    color: var(--text-primary);
    border: 1px solid var(--border-default);
  }

  /* ===============================================
     STEP CARDS (for numbered steps)
     =============================================== */
  .step-card {
    @apply relative pl-10 py-3;
  }

  .step-badge {
    @apply absolute left-0 top-3 w-7 h-7 rounded flex items-center justify-center text-xs font-bold;
    background-color: var(--bg-hover);
    color: var(--text-primary);
    border: 1px solid var(--border-strong);
  }

  /* ===============================================
     INFO CARDS
     =============================================== */
  .info-card {
    @apply border rounded-lg p-4;
    background-color: var(--bg-card);
    border-color: var(--border-default);
  }

  .info-card-header {
    @apply flex items-center gap-2.5 mb-2;
  }

  .info-card-icon {
    @apply w-8 h-8 rounded flex items-center justify-center;
    background-color: var(--bg-elevated);
    color: var(--text-muted);
    border: 1px solid var(--border-default);
  }

  .info-card-title {
    @apply text-sm font-semibold;
    color: var(--text-primary);
  }

  /* ===============================================
     TABLES ENHANCEMENT
     =============================================== */
  .guide-article table {
    @apply w-full mb-8 rounded-lg overflow-hidden border;
    border-color: var(--border-default);
    background-color: var(--bg-card);
  }

  .guide-article thead {
    background-color: var(--bg-elevated);
  }

  .guide-article th {
    @apply text-left px-4 py-3 text-xs font-semibold uppercase tracking-wider;
    color: var(--text-muted);
  }

  .guide-article td {
    @apply px-4 py-3 text-sm border-t;
    border-color: var(--border-default);
  }

  .guide-article tbody tr {
    background-color: var(--bg-card);
    transition: background-color var(--duration-fast) var(--ease-default);
  }

  .guide-article tbody tr:hover {
    background-color: var(--bg-hover);
  }

  /* ===============================================
     STATUS BADGES
     =============================================== */
  .status-high {
    @apply font-medium;
    color: var(--status-success);
  }

  .status-medium {
    @apply text-[var(--status-warning)] font-medium;
  }

  .status-low {
    @apply font-medium;
    color: var(--status-error);
  }

  /* ===============================================
     PRIORITY BADGES (WCAG AA compliant)
     =============================================== */
  .priority-badge {
    @apply inline-flex items-center px-2 py-0.5 rounded text-xs font-medium;
    background-color: var(--bg-elevated);
    color: var(--text-secondary);
    border: 1px solid var(--border-default);
  }

  .priority-badge.high {
    color: var(--status-success);
    border-color: var(--status-success);
  }

  .priority-badge.medium {
    background-color: var(--bg-elevated);
    color: var(--status-warning);
    border-color: var(--status-warning);
  }

  .priority-badge.low {
    color: var(--text-muted);
  }

  .priority-badge.penny {
    background-color: var(--bg-elevated);
    color: var(--status-success);
    border-color: var(--status-success);
  }

  /* ===============================================
     CHIP / PILL SYSTEM
     Unified tokens for badges and filters
     =============================================== */
  .pill {
    @apply inline-flex items-center gap-1.5 rounded-full text-xs font-semibold leading-snug;
    padding: 0.5rem 0.75rem;
    min-height: 32px;
    background-color: var(--chip-surface);
    color: var(--text-secondary);
    border: 1px solid var(--chip-border);
  }

  .pill-strong {
    background-color: var(--chip-surface-strong);
    color: var(--text-primary);
    border-color: var(--border-strong);
  }

  .pill-accent {
    background-color: var(--chip-accent-surface);
    color: var(--cta-primary);
    border-color: var(--chip-accent-border);
  }

  .pill-success {
    background-color: var(--chip-success-surface);
    color: var(--status-success);
    border-color: var(--chip-success-border);
  }

  .pill-muted {
    background-color: var(--chip-muted-surface);
    color: var(--text-muted);
    border-color: var(--chip-muted-border);
  }

  /* ===============================================
     LEAFLET MAP POPUP OVERRIDES
     Ensures popup is always visible, high contrast,
     and consistent with the design system.
     =============================================== */

  /* Popup container styling - Light mode */
  .leaflet-popup-content-wrapper {
    @apply rounded-xl shadow-lg border;
    padding: 0;
    overflow: hidden;
    background-color: var(--bg-card);
    border-color: var(--border-default);
  }

  .leaflet-popup-content {
    margin: 14px 16px;
    line-height: 1.5;
    font-size: 14px; /* Minimum 12px, using 14px for readability */
    color: var(--text-primary);
  }

  /* Popup tip (arrow) styling - Light mode */
  .leaflet-popup-tip-container {
    margin-top: -1px;
  }

  .leaflet-popup-tip {
    @apply border;
    box-shadow: none;
    background-color: var(--bg-card);
    border-color: var(--border-default);
  }

  /* Close button styling - Light mode */
  .leaflet-popup-close-button {
    color: var(--text-muted) !important;
    font-size: 20px !important;
    font-weight: 400 !important;
    width: 28px !important;
    height: 28px !important;
    top: 8px !important;
    right: 8px !important;
    padding: 0 !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    transition:
      background-color 0.15s ease,
      color 0.15s ease;
  }

  .leaflet-popup-close-button:hover {
    color: var(--text-primary) !important;
    background-color: var(--bg-hover) !important;
  }

  /* ===============================================
     DARK MODE POPUP OVERRIDES
     =============================================== */
  .dark .leaflet-popup-content-wrapper {
    background-color: var(--bg-card);
    border-color: var(--border-default);
  }

  .dark .leaflet-popup-content {
    color: var(--text-primary);
  }

  .dark .leaflet-popup-tip {
    background-color: var(--bg-card);
    border-color: var(--border-default);
  }

  .dark .leaflet-popup-close-button {
    color: var(--text-muted) !important;
  }

  .dark .leaflet-popup-close-button:hover {
    color: var(--text-primary) !important;
    background-color: var(--bg-hover) !important;
  }

  /* Ensure popup links have clear hover states */
  .store-popup-link {
    text-decoration: none;
    transition:
      color 0.15s ease,
      text-decoration 0.15s ease;
  }

  .store-popup-link:hover {
    text-decoration: underline;
  }

  /* Prevent popup from hugging edges - add margin to popup pane */
  .leaflet-popup {
    margin-bottom: 10px;
  }
}

/* ===============================================
   ANIMATIONS
   =============================================== */

/* Live indicator styles */
.live-indicator {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.live-dot {
  width: 8px;
  height: 8px;
  background: var(--live-indicator);
  border-radius: 50%;
  animation: live-pulse 2s ease-in-out infinite;
}

@keyframes live-pulse {
  0%,
  100% {
    opacity: 1;
    box-shadow: 0 0 0 0 var(--live-glow);
  }
  50% {
    opacity: 0.85;
    box-shadow: 0 0 0 8px transparent;
  }
}

@media (prefers-reduced-motion: no-preference) {
  .animate-radar {
    animation: live-pulse 2s ease-in-out infinite;
  }
}

@media (prefers-reduced-motion: reduce) {
  .animate-radar,
  .live-dot {
    animation: none;
  }
}

/* ===============================================
   TABLE TEXT UTILITIES
   =============================================== */
.line-clamp-2-table {
  display: -webkit-box;
  line-clamp: 2;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
